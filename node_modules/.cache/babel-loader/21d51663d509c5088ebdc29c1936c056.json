{"ast":null,"code":"var _class, _temp;\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nvar _require = require('@uppy/core'),\n  Plugin = _require.Plugin;\nvar Translator = require('@uppy/utils/lib/Translator');\nvar dataURItoBlob = require('@uppy/utils/lib/dataURItoBlob');\nvar isObjectURL = require('@uppy/utils/lib/isObjectURL');\nvar isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported');\nvar MathLog2 = require('math-log2'); // Polyfill for IE.\n\nvar exifr = require('exifr/dist/mini.legacy.umd.js');\n/**\n * The Thumbnail Generator plugin\n */\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function (_Plugin) {\n  _inheritsLoose(ThumbnailGenerator, _Plugin);\n  function ThumbnailGenerator(uppy, opts) {\n    var _this;\n    _this = _Plugin.call(this, uppy, opts) || this;\n    _this.onFileAdded = function (file) {\n      if (!file.preview && file.data && isPreviewSupported(file.type) && !file.isRemote) {\n        _this.addToQueue(file.id);\n      }\n    };\n    _this.onCancelRequest = function (file) {\n      var index = _this.queue.indexOf(file.id);\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      }\n    };\n    _this.onFileRemoved = function (file) {\n      var index = _this.queue.indexOf(file.id);\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      } // Clean up object URLs.\n\n      if (file.preview && isObjectURL(file.preview)) {\n        URL.revokeObjectURL(file.preview);\n      }\n    };\n    _this.onRestored = function () {\n      var restoredFiles = _this.uppy.getFiles().filter(function (file) {\n        return file.isRestored;\n      });\n      restoredFiles.forEach(function (file) {\n        // Only add blob URLs; they are likely invalid after being restored.\n        if (!file.preview || isObjectURL(file.preview)) {\n          _this.addToQueue(file.id);\n        }\n      });\n    };\n    _this.waitUntilAllProcessed = function (fileIDs) {\n      fileIDs.forEach(function (fileID) {\n        var file = _this.uppy.getFile(fileID);\n        _this.uppy.emit('preprocess-progress', file, {\n          mode: 'indeterminate',\n          message: _this.i18n('generatingThumbnails')\n        });\n      });\n      var emitPreprocessCompleteForAll = function emitPreprocessCompleteForAll() {\n        fileIDs.forEach(function (fileID) {\n          var file = _this.uppy.getFile(fileID);\n          _this.uppy.emit('preprocess-complete', file);\n        });\n      };\n      return new Promise(function (resolve, reject) {\n        if (_this.queueProcessing) {\n          _this.uppy.once('thumbnail:all-generated', function () {\n            emitPreprocessCompleteForAll();\n            resolve();\n          });\n        } else {\n          emitPreprocessCompleteForAll();\n          resolve();\n        }\n      });\n    };\n    _this.type = 'modifier';\n    _this.id = _this.opts.id || 'ThumbnailGenerator';\n    _this.title = 'Thumbnail Generator';\n    _this.queue = [];\n    _this.queueProcessing = false;\n    _this.defaultThumbnailDimension = 200;\n    _this.thumbnailType = _this.opts.thumbnailType || 'image/jpeg';\n    _this.defaultLocale = {\n      strings: {\n        generatingThumbnails: 'Generating thumbnails...'\n      }\n    };\n    var defaultOptions = {\n      thumbnailWidth: null,\n      thumbnailHeight: null,\n      waitForThumbnailsBeforeUpload: false,\n      lazy: false\n    };\n    _this.opts = _extends({}, defaultOptions, opts);\n    if (_this.opts.lazy && _this.opts.waitForThumbnailsBeforeUpload) {\n      throw new Error('ThumbnailGenerator: The `lazy` and `waitForThumbnailsBeforeUpload` options are mutually exclusive. Please ensure at most one of them is set to `true`.');\n    }\n    _this.i18nInit();\n    return _this;\n  }\n  var _proto = ThumbnailGenerator.prototype;\n  _proto.setOptions = function setOptions(newOpts) {\n    _Plugin.prototype.setOptions.call(this, newOpts);\n    this.i18nInit();\n  };\n  _proto.i18nInit = function i18nInit() {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale]);\n    this.i18n = this.translator.translate.bind(this.translator);\n    this.setPluginState(); // so that UI re-renders and we see the updated locale\n  }\n  /**\n   * Create a thumbnail for the given Uppy file object.\n   *\n   * @param {{data: Blob}} file\n   * @param {number} targetWidth\n   * @param {number} targetHeight\n   * @returns {Promise}\n   */;\n\n  _proto.createThumbnail = function createThumbnail(file, targetWidth, targetHeight) {\n    var _this2 = this;\n\n    // bug in the compatibility data\n    // eslint-disable-next-line compat/compat\n    var originalUrl = URL.createObjectURL(file.data);\n    var onload = new Promise(function (resolve, reject) {\n      var image = new Image();\n      image.src = originalUrl;\n      image.addEventListener('load', function () {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        resolve(image);\n      });\n      image.addEventListener('error', function (event) {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        reject(event.error || new Error('Could not create thumbnail'));\n      });\n    });\n    var orientationPromise = exifr.rotation(file.data).catch(function (_err) {\n      return 1;\n    });\n    return Promise.all([onload, orientationPromise]).then(function (_ref) {\n      var image = _ref[0],\n        orientation = _ref[1];\n      var dimensions = _this2.getProportionalDimensions(image, targetWidth, targetHeight, orientation.deg);\n      var rotatedImage = _this2.rotateImage(image, orientation);\n      var resizedImage = _this2.resizeImage(rotatedImage, dimensions.width, dimensions.height);\n      return _this2.canvasToBlob(resizedImage, _this2.thumbnailType, 80);\n    }).then(function (blob) {\n      // bug in the compatibility data\n      // eslint-disable-next-line compat/compat\n      return URL.createObjectURL(blob);\n    });\n  }\n  /**\n   * Get the new calculated dimensions for the given image and a target width\n   * or height. If both width and height are given, only width is taken into\n   * account. If neither width nor height are given, the default dimension\n   * is used.\n   */;\n\n  _proto.getProportionalDimensions = function getProportionalDimensions(img, width, height, rotation) {\n    var aspect = img.width / img.height;\n    if (rotation === 90 || rotation === 270) {\n      aspect = img.height / img.width;\n    }\n    if (width != null) {\n      return {\n        width: width,\n        height: Math.round(width / aspect)\n      };\n    }\n    if (height != null) {\n      return {\n        width: Math.round(height * aspect),\n        height: height\n      };\n    }\n    return {\n      width: this.defaultThumbnailDimension,\n      height: Math.round(this.defaultThumbnailDimension / aspect)\n    };\n  }\n  /**\n   * Make sure the image doesn’t exceed browser/device canvas limits.\n   * For ios with 256 RAM and ie\n   */;\n\n  _proto.protect = function protect(image) {\n    // https://stackoverflow.com/questions/6081483/maximum-size-of-a-canvas-element\n    var ratio = image.width / image.height;\n    var maxSquare = 5000000; // ios max canvas square\n\n    var maxSize = 4096; // ie max canvas dimensions\n\n    var maxW = Math.floor(Math.sqrt(maxSquare * ratio));\n    var maxH = Math.floor(maxSquare / Math.sqrt(maxSquare * ratio));\n    if (maxW > maxSize) {\n      maxW = maxSize;\n      maxH = Math.round(maxW / ratio);\n    }\n    if (maxH > maxSize) {\n      maxH = maxSize;\n      maxW = Math.round(ratio * maxH);\n    }\n    if (image.width > maxW) {\n      var canvas = document.createElement('canvas');\n      canvas.width = maxW;\n      canvas.height = maxH;\n      canvas.getContext('2d').drawImage(image, 0, 0, maxW, maxH);\n      image = canvas;\n    }\n    return image;\n  }\n  /**\n   * Resize an image to the target `width` and `height`.\n   *\n   * Returns a Canvas with the resized image on it.\n   */;\n\n  _proto.resizeImage = function resizeImage(image, targetWidth, targetHeight) {\n    // Resizing in steps refactored to use a solution from\n    // https://blog.uploadcare.com/image-resize-in-browsers-is-broken-e38eed08df01\n    image = this.protect(image);\n    var steps = Math.ceil(MathLog2(image.width / targetWidth));\n    if (steps < 1) {\n      steps = 1;\n    }\n    var sW = targetWidth * Math.pow(2, steps - 1);\n    var sH = targetHeight * Math.pow(2, steps - 1);\n    var x = 2;\n    while (steps--) {\n      var canvas = document.createElement('canvas');\n      canvas.width = sW;\n      canvas.height = sH;\n      canvas.getContext('2d').drawImage(image, 0, 0, sW, sH);\n      image = canvas;\n      sW = Math.round(sW / x);\n      sH = Math.round(sH / x);\n    }\n    return image;\n  };\n  _proto.rotateImage = function rotateImage(image, translate) {\n    var w = image.width;\n    var h = image.height;\n    if (translate.deg === 90 || translate.deg === 270) {\n      w = image.height;\n      h = image.width;\n    }\n    var canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h;\n    var context = canvas.getContext('2d');\n    context.translate(w / 2, h / 2);\n    if (translate.canvas) {\n      context.rotate(translate.rad);\n      context.scale(translate.scaleX, translate.scaleY);\n    }\n    context.drawImage(image, -image.width / 2, -image.height / 2, image.width, image.height);\n    return canvas;\n  }\n  /**\n   * Save a <canvas> element's content to a Blob object.\n   *\n   * @param {HTMLCanvasElement} canvas\n   * @returns {Promise}\n   */;\n\n  _proto.canvasToBlob = function canvasToBlob(canvas, type, quality) {\n    try {\n      canvas.getContext('2d').getImageData(0, 0, 1, 1);\n    } catch (err) {\n      if (err.code === 18) {\n        return Promise.reject(new Error('cannot read image, probably an svg with external resources'));\n      }\n    }\n    if (canvas.toBlob) {\n      return new Promise(function (resolve) {\n        canvas.toBlob(resolve, type, quality);\n      }).then(function (blob) {\n        if (blob === null) {\n          throw new Error('cannot read image, probably an svg with external resources');\n        }\n        return blob;\n      });\n    }\n    return Promise.resolve().then(function () {\n      return dataURItoBlob(canvas.toDataURL(type, quality), {});\n    }).then(function (blob) {\n      if (blob === null) {\n        throw new Error('could not extract blob, probably an old browser');\n      }\n      return blob;\n    });\n  }\n  /**\n   * Set the preview URL for a file.\n   */;\n\n  _proto.setPreviewURL = function setPreviewURL(fileID, preview) {\n    this.uppy.setFileState(fileID, {\n      preview: preview\n    });\n  };\n  _proto.addToQueue = function addToQueue(item) {\n    this.queue.push(item);\n    if (this.queueProcessing === false) {\n      this.processQueue();\n    }\n  };\n  _proto.processQueue = function processQueue() {\n    var _this3 = this;\n    this.queueProcessing = true;\n    if (this.queue.length > 0) {\n      var current = this.uppy.getFile(this.queue.shift());\n      if (!current) {\n        this.uppy.log('[ThumbnailGenerator] file was removed before a thumbnail could be generated, but not removed from the queue. This is probably a bug', 'error');\n        return;\n      }\n      return this.requestThumbnail(current).catch(function (err) {}) // eslint-disable-line handle-callback-err\n      .then(function () {\n        return _this3.processQueue();\n      });\n    }\n    this.queueProcessing = false;\n    this.uppy.log('[ThumbnailGenerator] Emptied thumbnail queue');\n    this.uppy.emit('thumbnail:all-generated');\n  };\n  _proto.requestThumbnail = function requestThumbnail(file) {\n    var _this4 = this;\n    if (isPreviewSupported(file.type) && !file.isRemote) {\n      return this.createThumbnail(file, this.opts.thumbnailWidth, this.opts.thumbnailHeight).then(function (preview) {\n        _this4.setPreviewURL(file.id, preview);\n        _this4.uppy.log(\"[ThumbnailGenerator] Generated thumbnail for \" + file.id);\n        _this4.uppy.emit('thumbnail:generated', _this4.uppy.getFile(file.id), preview);\n      }).catch(function (err) {\n        _this4.uppy.log(\"[ThumbnailGenerator] Failed thumbnail for \" + file.id + \":\", 'warning');\n        _this4.uppy.log(err, 'warning');\n        _this4.uppy.emit('thumbnail:error', _this4.uppy.getFile(file.id), err);\n      });\n    }\n    return Promise.resolve();\n  };\n  _proto.install = function install() {\n    this.uppy.on('file-removed', this.onFileRemoved);\n    if (this.opts.lazy) {\n      this.uppy.on('thumbnail:request', this.onFileAdded);\n      this.uppy.on('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.on('file-added', this.onFileAdded);\n      this.uppy.on('restored', this.onRestored);\n    }\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.addPreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n  _proto.uninstall = function uninstall() {\n    this.uppy.off('file-removed', this.onFileRemoved);\n    if (this.opts.lazy) {\n      this.uppy.off('thumbnail:request', this.onFileAdded);\n      this.uppy.off('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.off('file-added', this.onFileAdded);\n      this.uppy.off('restored', this.onRestored);\n    }\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.removePreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n  return ThumbnailGenerator;\n}(Plugin), _class.VERSION = \"1.7.11\", _temp);","map":{"version":3,"names":["_class","_temp","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_require","require","Plugin","Translator","dataURItoBlob","isObjectURL","isPreviewSupported","MathLog2","exifr","module","exports","_Plugin","ThumbnailGenerator","uppy","opts","_this","onFileAdded","file","preview","data","type","isRemote","addToQueue","id","onCancelRequest","index","queue","indexOf","splice","onFileRemoved","URL","revokeObjectURL","onRestored","restoredFiles","getFiles","filter","isRestored","forEach","waitUntilAllProcessed","fileIDs","fileID","getFile","emit","mode","message","i18n","emitPreprocessCompleteForAll","Promise","resolve","reject","queueProcessing","once","title","defaultThumbnailDimension","thumbnailType","defaultLocale","strings","generatingThumbnails","defaultOptions","thumbnailWidth","thumbnailHeight","waitForThumbnailsBeforeUpload","lazy","Error","i18nInit","_proto","setOptions","newOpts","translator","locale","translate","bind","setPluginState","createThumbnail","targetWidth","targetHeight","_this2","originalUrl","createObjectURL","onload","image","Image","src","addEventListener","event","error","orientationPromise","rotation","catch","_err","all","then","_ref","orientation","dimensions","getProportionalDimensions","deg","rotatedImage","rotateImage","resizedImage","resizeImage","width","height","canvasToBlob","blob","img","aspect","Math","round","protect","ratio","maxSquare","maxSize","maxW","floor","sqrt","maxH","canvas","document","createElement","getContext","drawImage","steps","ceil","sW","pow","sH","x","w","h","context","rotate","rad","scale","scaleX","scaleY","quality","getImageData","err","code","toBlob","toDataURL","setPreviewURL","setFileState","item","push","processQueue","_this3","current","shift","log","requestThumbnail","_this4","install","on","addPreProcessor","uninstall","off","removePreProcessor","VERSION"],"sources":["E:/integrate cloud/uppy/node_modules/@uppy/thumbnail-generator/lib/index.js"],"sourcesContent":["var _class, _temp;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nvar _require = require('@uppy/core'),\n    Plugin = _require.Plugin;\n\nvar Translator = require('@uppy/utils/lib/Translator');\n\nvar dataURItoBlob = require('@uppy/utils/lib/dataURItoBlob');\n\nvar isObjectURL = require('@uppy/utils/lib/isObjectURL');\n\nvar isPreviewSupported = require('@uppy/utils/lib/isPreviewSupported');\n\nvar MathLog2 = require('math-log2'); // Polyfill for IE.\n\n\nvar exifr = require('exifr/dist/mini.legacy.umd.js');\n/**\n * The Thumbnail Generator plugin\n */\n\n\nmodule.exports = (_temp = _class = /*#__PURE__*/function (_Plugin) {\n  _inheritsLoose(ThumbnailGenerator, _Plugin);\n\n  function ThumbnailGenerator(uppy, opts) {\n    var _this;\n\n    _this = _Plugin.call(this, uppy, opts) || this;\n\n    _this.onFileAdded = function (file) {\n      if (!file.preview && file.data && isPreviewSupported(file.type) && !file.isRemote) {\n        _this.addToQueue(file.id);\n      }\n    };\n\n    _this.onCancelRequest = function (file) {\n      var index = _this.queue.indexOf(file.id);\n\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      }\n    };\n\n    _this.onFileRemoved = function (file) {\n      var index = _this.queue.indexOf(file.id);\n\n      if (index !== -1) {\n        _this.queue.splice(index, 1);\n      } // Clean up object URLs.\n\n\n      if (file.preview && isObjectURL(file.preview)) {\n        URL.revokeObjectURL(file.preview);\n      }\n    };\n\n    _this.onRestored = function () {\n      var restoredFiles = _this.uppy.getFiles().filter(function (file) {\n        return file.isRestored;\n      });\n\n      restoredFiles.forEach(function (file) {\n        // Only add blob URLs; they are likely invalid after being restored.\n        if (!file.preview || isObjectURL(file.preview)) {\n          _this.addToQueue(file.id);\n        }\n      });\n    };\n\n    _this.waitUntilAllProcessed = function (fileIDs) {\n      fileIDs.forEach(function (fileID) {\n        var file = _this.uppy.getFile(fileID);\n\n        _this.uppy.emit('preprocess-progress', file, {\n          mode: 'indeterminate',\n          message: _this.i18n('generatingThumbnails')\n        });\n      });\n\n      var emitPreprocessCompleteForAll = function emitPreprocessCompleteForAll() {\n        fileIDs.forEach(function (fileID) {\n          var file = _this.uppy.getFile(fileID);\n\n          _this.uppy.emit('preprocess-complete', file);\n        });\n      };\n\n      return new Promise(function (resolve, reject) {\n        if (_this.queueProcessing) {\n          _this.uppy.once('thumbnail:all-generated', function () {\n            emitPreprocessCompleteForAll();\n            resolve();\n          });\n        } else {\n          emitPreprocessCompleteForAll();\n          resolve();\n        }\n      });\n    };\n\n    _this.type = 'modifier';\n    _this.id = _this.opts.id || 'ThumbnailGenerator';\n    _this.title = 'Thumbnail Generator';\n    _this.queue = [];\n    _this.queueProcessing = false;\n    _this.defaultThumbnailDimension = 200;\n    _this.thumbnailType = _this.opts.thumbnailType || 'image/jpeg';\n    _this.defaultLocale = {\n      strings: {\n        generatingThumbnails: 'Generating thumbnails...'\n      }\n    };\n    var defaultOptions = {\n      thumbnailWidth: null,\n      thumbnailHeight: null,\n      waitForThumbnailsBeforeUpload: false,\n      lazy: false\n    };\n    _this.opts = _extends({}, defaultOptions, opts);\n\n    if (_this.opts.lazy && _this.opts.waitForThumbnailsBeforeUpload) {\n      throw new Error('ThumbnailGenerator: The `lazy` and `waitForThumbnailsBeforeUpload` options are mutually exclusive. Please ensure at most one of them is set to `true`.');\n    }\n\n    _this.i18nInit();\n\n    return _this;\n  }\n\n  var _proto = ThumbnailGenerator.prototype;\n\n  _proto.setOptions = function setOptions(newOpts) {\n    _Plugin.prototype.setOptions.call(this, newOpts);\n\n    this.i18nInit();\n  };\n\n  _proto.i18nInit = function i18nInit() {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale]);\n    this.i18n = this.translator.translate.bind(this.translator);\n    this.setPluginState(); // so that UI re-renders and we see the updated locale\n  }\n  /**\n   * Create a thumbnail for the given Uppy file object.\n   *\n   * @param {{data: Blob}} file\n   * @param {number} targetWidth\n   * @param {number} targetHeight\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.createThumbnail = function createThumbnail(file, targetWidth, targetHeight) {\n    var _this2 = this;\n\n    // bug in the compatibility data\n    // eslint-disable-next-line compat/compat\n    var originalUrl = URL.createObjectURL(file.data);\n    var onload = new Promise(function (resolve, reject) {\n      var image = new Image();\n      image.src = originalUrl;\n      image.addEventListener('load', function () {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        resolve(image);\n      });\n      image.addEventListener('error', function (event) {\n        // bug in the compatibility data\n        // eslint-disable-next-line compat/compat\n        URL.revokeObjectURL(originalUrl);\n        reject(event.error || new Error('Could not create thumbnail'));\n      });\n    });\n    var orientationPromise = exifr.rotation(file.data).catch(function (_err) {\n      return 1;\n    });\n    return Promise.all([onload, orientationPromise]).then(function (_ref) {\n      var image = _ref[0],\n          orientation = _ref[1];\n\n      var dimensions = _this2.getProportionalDimensions(image, targetWidth, targetHeight, orientation.deg);\n\n      var rotatedImage = _this2.rotateImage(image, orientation);\n\n      var resizedImage = _this2.resizeImage(rotatedImage, dimensions.width, dimensions.height);\n\n      return _this2.canvasToBlob(resizedImage, _this2.thumbnailType, 80);\n    }).then(function (blob) {\n      // bug in the compatibility data\n      // eslint-disable-next-line compat/compat\n      return URL.createObjectURL(blob);\n    });\n  }\n  /**\n   * Get the new calculated dimensions for the given image and a target width\n   * or height. If both width and height are given, only width is taken into\n   * account. If neither width nor height are given, the default dimension\n   * is used.\n   */\n  ;\n\n  _proto.getProportionalDimensions = function getProportionalDimensions(img, width, height, rotation) {\n    var aspect = img.width / img.height;\n\n    if (rotation === 90 || rotation === 270) {\n      aspect = img.height / img.width;\n    }\n\n    if (width != null) {\n      return {\n        width: width,\n        height: Math.round(width / aspect)\n      };\n    }\n\n    if (height != null) {\n      return {\n        width: Math.round(height * aspect),\n        height: height\n      };\n    }\n\n    return {\n      width: this.defaultThumbnailDimension,\n      height: Math.round(this.defaultThumbnailDimension / aspect)\n    };\n  }\n  /**\n   * Make sure the image doesn’t exceed browser/device canvas limits.\n   * For ios with 256 RAM and ie\n   */\n  ;\n\n  _proto.protect = function protect(image) {\n    // https://stackoverflow.com/questions/6081483/maximum-size-of-a-canvas-element\n    var ratio = image.width / image.height;\n    var maxSquare = 5000000; // ios max canvas square\n\n    var maxSize = 4096; // ie max canvas dimensions\n\n    var maxW = Math.floor(Math.sqrt(maxSquare * ratio));\n    var maxH = Math.floor(maxSquare / Math.sqrt(maxSquare * ratio));\n\n    if (maxW > maxSize) {\n      maxW = maxSize;\n      maxH = Math.round(maxW / ratio);\n    }\n\n    if (maxH > maxSize) {\n      maxH = maxSize;\n      maxW = Math.round(ratio * maxH);\n    }\n\n    if (image.width > maxW) {\n      var canvas = document.createElement('canvas');\n      canvas.width = maxW;\n      canvas.height = maxH;\n      canvas.getContext('2d').drawImage(image, 0, 0, maxW, maxH);\n      image = canvas;\n    }\n\n    return image;\n  }\n  /**\n   * Resize an image to the target `width` and `height`.\n   *\n   * Returns a Canvas with the resized image on it.\n   */\n  ;\n\n  _proto.resizeImage = function resizeImage(image, targetWidth, targetHeight) {\n    // Resizing in steps refactored to use a solution from\n    // https://blog.uploadcare.com/image-resize-in-browsers-is-broken-e38eed08df01\n    image = this.protect(image);\n    var steps = Math.ceil(MathLog2(image.width / targetWidth));\n\n    if (steps < 1) {\n      steps = 1;\n    }\n\n    var sW = targetWidth * Math.pow(2, steps - 1);\n    var sH = targetHeight * Math.pow(2, steps - 1);\n    var x = 2;\n\n    while (steps--) {\n      var canvas = document.createElement('canvas');\n      canvas.width = sW;\n      canvas.height = sH;\n      canvas.getContext('2d').drawImage(image, 0, 0, sW, sH);\n      image = canvas;\n      sW = Math.round(sW / x);\n      sH = Math.round(sH / x);\n    }\n\n    return image;\n  };\n\n  _proto.rotateImage = function rotateImage(image, translate) {\n    var w = image.width;\n    var h = image.height;\n\n    if (translate.deg === 90 || translate.deg === 270) {\n      w = image.height;\n      h = image.width;\n    }\n\n    var canvas = document.createElement('canvas');\n    canvas.width = w;\n    canvas.height = h;\n    var context = canvas.getContext('2d');\n    context.translate(w / 2, h / 2);\n\n    if (translate.canvas) {\n      context.rotate(translate.rad);\n      context.scale(translate.scaleX, translate.scaleY);\n    }\n\n    context.drawImage(image, -image.width / 2, -image.height / 2, image.width, image.height);\n    return canvas;\n  }\n  /**\n   * Save a <canvas> element's content to a Blob object.\n   *\n   * @param {HTMLCanvasElement} canvas\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.canvasToBlob = function canvasToBlob(canvas, type, quality) {\n    try {\n      canvas.getContext('2d').getImageData(0, 0, 1, 1);\n    } catch (err) {\n      if (err.code === 18) {\n        return Promise.reject(new Error('cannot read image, probably an svg with external resources'));\n      }\n    }\n\n    if (canvas.toBlob) {\n      return new Promise(function (resolve) {\n        canvas.toBlob(resolve, type, quality);\n      }).then(function (blob) {\n        if (blob === null) {\n          throw new Error('cannot read image, probably an svg with external resources');\n        }\n\n        return blob;\n      });\n    }\n\n    return Promise.resolve().then(function () {\n      return dataURItoBlob(canvas.toDataURL(type, quality), {});\n    }).then(function (blob) {\n      if (blob === null) {\n        throw new Error('could not extract blob, probably an old browser');\n      }\n\n      return blob;\n    });\n  }\n  /**\n   * Set the preview URL for a file.\n   */\n  ;\n\n  _proto.setPreviewURL = function setPreviewURL(fileID, preview) {\n    this.uppy.setFileState(fileID, {\n      preview: preview\n    });\n  };\n\n  _proto.addToQueue = function addToQueue(item) {\n    this.queue.push(item);\n\n    if (this.queueProcessing === false) {\n      this.processQueue();\n    }\n  };\n\n  _proto.processQueue = function processQueue() {\n    var _this3 = this;\n\n    this.queueProcessing = true;\n\n    if (this.queue.length > 0) {\n      var current = this.uppy.getFile(this.queue.shift());\n\n      if (!current) {\n        this.uppy.log('[ThumbnailGenerator] file was removed before a thumbnail could be generated, but not removed from the queue. This is probably a bug', 'error');\n        return;\n      }\n\n      return this.requestThumbnail(current).catch(function (err) {}) // eslint-disable-line handle-callback-err\n      .then(function () {\n        return _this3.processQueue();\n      });\n    }\n\n    this.queueProcessing = false;\n    this.uppy.log('[ThumbnailGenerator] Emptied thumbnail queue');\n    this.uppy.emit('thumbnail:all-generated');\n  };\n\n  _proto.requestThumbnail = function requestThumbnail(file) {\n    var _this4 = this;\n\n    if (isPreviewSupported(file.type) && !file.isRemote) {\n      return this.createThumbnail(file, this.opts.thumbnailWidth, this.opts.thumbnailHeight).then(function (preview) {\n        _this4.setPreviewURL(file.id, preview);\n\n        _this4.uppy.log(\"[ThumbnailGenerator] Generated thumbnail for \" + file.id);\n\n        _this4.uppy.emit('thumbnail:generated', _this4.uppy.getFile(file.id), preview);\n      }).catch(function (err) {\n        _this4.uppy.log(\"[ThumbnailGenerator] Failed thumbnail for \" + file.id + \":\", 'warning');\n\n        _this4.uppy.log(err, 'warning');\n\n        _this4.uppy.emit('thumbnail:error', _this4.uppy.getFile(file.id), err);\n      });\n    }\n\n    return Promise.resolve();\n  };\n\n  _proto.install = function install() {\n    this.uppy.on('file-removed', this.onFileRemoved);\n\n    if (this.opts.lazy) {\n      this.uppy.on('thumbnail:request', this.onFileAdded);\n      this.uppy.on('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.on('file-added', this.onFileAdded);\n      this.uppy.on('restored', this.onRestored);\n    }\n\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.addPreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n\n  _proto.uninstall = function uninstall() {\n    this.uppy.off('file-removed', this.onFileRemoved);\n\n    if (this.opts.lazy) {\n      this.uppy.off('thumbnail:request', this.onFileAdded);\n      this.uppy.off('thumbnail:cancel', this.onCancelRequest);\n    } else {\n      this.uppy.off('file-added', this.onFileAdded);\n      this.uppy.off('restored', this.onRestored);\n    }\n\n    if (this.opts.waitForThumbnailsBeforeUpload) {\n      this.uppy.removePreProcessor(this.waitUntilAllProcessed);\n    }\n  };\n\n  return ThumbnailGenerator;\n}(Plugin), _class.VERSION = \"1.7.11\", _temp);"],"mappings":"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"},"metadata":{},"sourceType":"script"}