{"ast":null,"code":"var ee = require('namespace-emitter');\nmodule.exports = /*#__PURE__*/function () {\n  function UppySocket(opts) {\n    this.opts = opts;\n    this._queued = [];\n    this.isOpen = false;\n    this.emitter = ee();\n    this._handleMessage = this._handleMessage.bind(this);\n    this.close = this.close.bind(this);\n    this.emit = this.emit.bind(this);\n    this.on = this.on.bind(this);\n    this.once = this.once.bind(this);\n    this.send = this.send.bind(this);\n    if (!opts || opts.autoOpen !== false) {\n      this.open();\n    }\n  }\n  var _proto = UppySocket.prototype;\n  _proto.open = function open() {\n    var _this = this;\n    this.socket = new WebSocket(this.opts.target);\n    this.socket.onopen = function (e) {\n      _this.isOpen = true;\n      while (_this._queued.length > 0 && _this.isOpen) {\n        var first = _this._queued[0];\n        _this.send(first.action, first.payload);\n        _this._queued = _this._queued.slice(1);\n      }\n    };\n    this.socket.onclose = function (e) {\n      _this.isOpen = false;\n    };\n    this.socket.onmessage = this._handleMessage;\n  };\n  _proto.close = function close() {\n    if (this.socket) {\n      this.socket.close();\n    }\n  };\n  _proto.send = function send(action, payload) {\n    // attach uuid\n    if (!this.isOpen) {\n      this._queued.push({\n        action: action,\n        payload: payload\n      });\n      return;\n    }\n    this.socket.send(JSON.stringify({\n      action: action,\n      payload: payload\n    }));\n  };\n  _proto.on = function on(action, handler) {\n    this.emitter.on(action, handler);\n  };\n  _proto.emit = function emit(action, payload) {\n    this.emitter.emit(action, payload);\n  };\n  _proto.once = function once(action, handler) {\n    this.emitter.once(action, handler);\n  };\n  _proto._handleMessage = function _handleMessage(e) {\n    try {\n      var message = JSON.parse(e.data);\n      this.emit(message.action, message.payload);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  return UppySocket;\n}();","map":{"version":3,"names":["ee","require","module","exports","UppySocket","opts","_queued","isOpen","emitter","_handleMessage","bind","close","emit","on","once","send","autoOpen","open","_proto","prototype","_this","socket","WebSocket","target","onopen","e","length","first","action","payload","slice","onclose","onmessage","push","JSON","stringify","handler","message","parse","data","err","console","log"],"sources":["E:/integrate cloud/uppy/node_modules/@uppy/companion-client/lib/Socket.js"],"sourcesContent":["var ee = require('namespace-emitter');\n\nmodule.exports = /*#__PURE__*/function () {\n  function UppySocket(opts) {\n    this.opts = opts;\n    this._queued = [];\n    this.isOpen = false;\n    this.emitter = ee();\n    this._handleMessage = this._handleMessage.bind(this);\n    this.close = this.close.bind(this);\n    this.emit = this.emit.bind(this);\n    this.on = this.on.bind(this);\n    this.once = this.once.bind(this);\n    this.send = this.send.bind(this);\n\n    if (!opts || opts.autoOpen !== false) {\n      this.open();\n    }\n  }\n\n  var _proto = UppySocket.prototype;\n\n  _proto.open = function open() {\n    var _this = this;\n\n    this.socket = new WebSocket(this.opts.target);\n\n    this.socket.onopen = function (e) {\n      _this.isOpen = true;\n\n      while (_this._queued.length > 0 && _this.isOpen) {\n        var first = _this._queued[0];\n\n        _this.send(first.action, first.payload);\n\n        _this._queued = _this._queued.slice(1);\n      }\n    };\n\n    this.socket.onclose = function (e) {\n      _this.isOpen = false;\n    };\n\n    this.socket.onmessage = this._handleMessage;\n  };\n\n  _proto.close = function close() {\n    if (this.socket) {\n      this.socket.close();\n    }\n  };\n\n  _proto.send = function send(action, payload) {\n    // attach uuid\n    if (!this.isOpen) {\n      this._queued.push({\n        action: action,\n        payload: payload\n      });\n\n      return;\n    }\n\n    this.socket.send(JSON.stringify({\n      action: action,\n      payload: payload\n    }));\n  };\n\n  _proto.on = function on(action, handler) {\n    this.emitter.on(action, handler);\n  };\n\n  _proto.emit = function emit(action, payload) {\n    this.emitter.emit(action, payload);\n  };\n\n  _proto.once = function once(action, handler) {\n    this.emitter.once(action, handler);\n  };\n\n  _proto._handleMessage = function _handleMessage(e) {\n    try {\n      var message = JSON.parse(e.data);\n      this.emit(message.action, message.payload);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  return UppySocket;\n}();"],"mappings":"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"},"metadata":{},"sourceType":"script"}